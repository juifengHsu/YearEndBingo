<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 å°¾ç‰™è³“æœç³»çµ±  0.02</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #d32f2f; --secondary: #ffc107; --bg: #f8f9fa; --success: #2e7d32; --dark: #2c3e50; }
        body { font-family: -apple-system, system-ui, sans-serif; margin: 0; background: var(--bg); text-align: center; color: #333; user-select: none; }
        .page { display: none !important; padding: 20px; box-sizing: border-box; min-height: 100vh; }
        .page.active { display: flex !important; flex-direction: column; align-items: center; }
        .login-container { margin-top: 15vh; width: 100%; max-width: 320px; }
        h1 { color: var(--primary); font-size: 2.5rem; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; width: 100%; max-width: 360px; background: #fff; padding: 10px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        .cell { aspect-ratio: 1; border: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; font-weight: 700; border-radius: 8px; background: #fafafa; }
        .cell.selected { background: var(--secondary); color: #b71c1c; }
        .cell.bingo-line { background: var(--primary) !important; color: white !important; animation: pulse 1s infinite; }
        .big-number { font-size: 5rem; color: var(--primary); font-weight: 800; margin: 10px 0; min-height: 100px; }
        #page-admin { background: var(--dark); color: white; text-align: left; align-items: stretch; }
        .admin-card { background: #34495e; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        button { padding: 12px; border: none; border-radius: 8px; background: var(--primary); color: white; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        input { padding: 12px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; width: 80%; text-align: center; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    </style>
</head>
<body>

    <div id="page-login" class="page active">
        <div class="login-container">
            <h1 onclick="handleAdminClick()">ğŸ§§ 2025<br>å°¾ç‰™è³“æœ</h1>
            <input type="text" id="username-input" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å">
            <button id="btn-login" onclick="handleLogin()" style="width: 85%;">é€²å…¥éŠæˆ²</button>
        </div>
    </div>

    <div id="page-game" class="page">
        <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px;">
            <span id="display-name">è¼‰å…¥ä¸­...</span>
            <span id="status-tag">ğŸŸ¢ åœ¨ç·š</span>
        </div>
        <div class="big-number" id="current-draw">READY</div>
        <div id="status-text" style="font-weight:bold; margin-bottom:10px; color:var(--success);">è«‹å…ˆä¿å­˜ç›¤é¢</div>
        <div class="grid" id="bingo-grid"></div>
        <div id="setup-controls" style="margin-top:15px; display:flex; gap:10px; width:100%; max-width:360px;">
            <button onclick="generateBoard()" style="background:#546e7a; flex:1;">ğŸ² éš¨æ©Ÿæ›è™Ÿ</button>
            <button onclick="lockBoard()" id="btn-lock-real" style="background:var(--success); flex:1;">ğŸ”’ ä¿å­˜ç›¤é¢</button>
        </div>
    </div>

    <div id="page-admin" class="page">
        <h2>âš™ï¸ ç®¡ç†å“¡æ§åˆ¶å°</h2>
        <div class="admin-card">
            <button onclick="drawNumber()" style="width:100%; background:#e67e22; margin-bottom:10px; font-size:1.2rem;">ğŸ² éš¨æ©ŸæŠ½è™Ÿç¢¼</button>
            <button onclick="pickLuckyPlayer()" style="width:100%; background:var(--secondary); color:#333; font-size:1.2rem;">ğŸŒŸ æŠ½å¤©é¸ä¹‹äºº</button>
        </div>
        <div class="admin-card">é–‹çæ­·å²: <div id="admin-history" style="word-break: break-all; margin-top:5px; color:var(--secondary);"></div></div>
        <div id="admin-pending-area" class="admin-card" style="display:none; border:2px solid var(--secondary);">
            <strong>å¾…å¯©æ ¸é¸è™Ÿ:</strong> <div id="pending-list"></div>
        </div>
        <button onclick="location.reload()" style="background:none; border:1px solid white;">ç™»å‡º/å›é¦–é </button>
    </div>

    <div id="lucky-modal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index:99; backdrop-filter: blur(5px);">
        <div style="background:white; padding:25px; border-radius:15px; width:80%; color:#333; text-align:center;">
            <h2 style="color:var(--primary); margin-top:0;">ğŸŒŸ ä½ è¢«æŠ½ä¸­äº†ï¼</h2>
            <p>è«‹æ±ºå®šä¸‹ä¸€å€‹é–‹çè™Ÿç¢¼ (1-25)ï¼š</p>
            <input type="number" id="lucky-num-input" min="1" max="25" style="font-size:1.5rem; width:100px;">
            <button onclick="submitLuckyChoice()" style="width:100%; font-size:1.1rem; margin-top:10px;">ç¢ºèªé€å‡º</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCLTGzCZUQm2ZzqfdBHk9D4xYpagaVtX7w",
            authDomain: "yearendbingo.firebaseapp.com",
            projectId: "yearendbingo",
            storageBucket: "yearendbingo.firebasestorage.app",
            messagingSenderId: "563353011392",
            appId: "1:563353011392:web:717976a176bc22a04d5925",
            measurementId: "G-M6EVYSPNJ9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUser = null;
        let myData = { name: "", board: [], locked: false };
        let gameHistory = [];
        let adminClickCount = 0;
        let rollingInterval = null;

        async function handleLogin() {
            const name = document.getElementById('username-input').value.trim();
            if(!name) return alert("è«‹è¼¸å…¥çœŸå¯¦å§“åä»¥åˆ©ä¸­çæ ¸å°");
            document.getElementById('btn-login').disabled = true;

            try {
                const userCred = await auth.signInAnonymously();
                currentUser = userCred.user;
                myData.name = name;

                const docRef = db.collection("players").doc(currentUser.uid);
                const docSnap = await docRef.get();

                if(docSnap.exists) {
                    const d = docSnap.data();
                    myData.board = d.board || [];
                    myData.locked = d.locked || false;
