<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>2025 å°¾ç‰™è³“æœç³»çµ± v2.9.1 - å¤§å­—å°Šäº«ç‰ˆ</title>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#f45925", // æ¡ç”¨ new 9 çš„æ´»åŠ›æ©˜ [cite: 800]
                        "primary-dark": "#d64010",
                        "bg-main": "#f8f6f5",
                        "card-dark": "#1c110d"
                    },
                    borderRadius: { "DEFAULT": "1.5rem" }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8f6f5; }
        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; width: 100%; }
        /* é‡å°é•·è¼©è¨­è¨ˆçš„å¤§è™Ÿç¢¼æ ¼å­ [cite: 804, 805] */
        .cell { 
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center; 
            border-radius: 50%; font-weight: 900; font-size: 2.5rem; /* å­—é«”åŠ å¤§ */
            background-color: #ffffff; border: 4px solid #f4eae7; transition: all 0.2s;
        }
        .cell.selected { background-color: #fdeee9; color: #f45925; border-color: #f45925; }
        .cell.bingo-line { background-color: #2e7d32; color: #ffffff; border-color: #1b5e20; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        .history-ball {
            display: inline-flex; width: 50px; height: 50px; align-items: center; justify-content: center;
            background: #1c110d; color: white; border-radius: 50%; margin: 4px; font-weight: bold; font-size: 1.2rem;
        }
        .btn-large { padding: 20px; border-radius: 2rem; font-size: 1.5rem; font-weight: 700; transition: transform 0.1s; }
        .btn-large:active { transform: scale(0.95); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 999; }
    </style>
</head>
<body class="text-[#1c110d]">

<div id="admin-modal" class="modal-overlay">
    <div class="bg-white p-8 rounded-3xl w-full max-w-md mx-4">
        <h3 class="text-2xl font-bold mb-4">ç®¡ç†è€…ç™»å…¥</h3>
        <input id="admin-email" type="email" placeholder="Email" class="w-full p-4 mb-4 border-2 border-gray-200 rounded-xl text-lg">
        <input id="admin-pwd" type="password" placeholder="å¯†ç¢¼" class="w-full p-4 mb-4 border-2 border-gray-200 rounded-xl text-lg">
        <button class="w-full bg-primary text-white btn-large mb-2" onclick="doAdminLogin()">ç™»å…¥</button>
        <button class="w-full bg-gray-200 text-gray-700 btn-large" onclick="closeAdminModal()">å–æ¶ˆ</button>
    </div>
</div>

<div class="min-h-screen flex flex-col">
    <header class="bg-white border-b border-gray-200 p-6 flex justify-between items-center sticky top-0 z-10">
        <div class="flex items-center gap-3 cursor-pointer" onclick="triggerAdmin()">
            <div class="bg-primary p-2 rounded-full text-white"><span class="material-symbols-outlined">grid_on</span></div>
            <h1 class="text-2xl font-black text-primary">2025 å°¾ç‰™è³“æœ</h1>
        </div>
        <div id="user-info" class="text-xl font-bold text-gray-500">è¼‰å…¥ä¸­...</div>
    </header>

    <main class="flex-grow p-4 sm:p-8">
        
        <div id="view-login" class="hidden flex flex-col items-center justify-center py-20">
            <div class="bg-white p-10 rounded-[3rem] shadow-xl w-full max-w-2xl border-2 border-primary/10">
                <h2 class="text-4xl font-black mb-8 text-center">æ­¡è¿åƒåŠ è³“æœéŠæˆ²</h2>
                <input id="player-name" type="text" placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å" class="w-full p-6 text-2xl border-4 border-gray-100 rounded-3xl mb-6 focus:border-primary outline-none">
                <button class="w-full bg-primary text-white btn-large shadow-lg shadow-primary/30 py-8 text-3xl" onclick="doPlayerLogin()">
                    <span class="flex items-center justify-center gap-4">
                        <span class="material-symbols-outlined text-4xl">login</span> é–‹å§‹éŠæˆ²
                    </span>
                </button>
            </div>
        </div>

        <div id="view-player" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-100">
                        <p class="text-gray-500 font-bold uppercase tracking-widest text-sm mb-2">ç•¶å‰é–‹å‡ºè™Ÿç¢¼</p>
                        <div id="draw-display" class="text-[8rem] font-black text-primary leading-none text-center py-4">READY</div>
                        <div id="bingo-status" class="text-2xl text-center font-black text-green-600 h-10"></div>
                    </div>
                    <div class="bg-card-dark text-white p-8 rounded-[2.5rem] shadow-xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold" id="player-name-display"></h3>
                            <button class="text-gray-400 hover:text-white" onclick="doSignOut()">ç™»å‡º</button>
                        </div>
                        <div id="lock-status-label" class="text-lg font-medium opacity-70"></div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="bg-white p-6 sm:p-10 rounded-[3rem] shadow-lg">
                        <div class="bingo-grid" id="bingo-grid"></div>
                        
                        <div id="setup-btns" class="mt-10 grid grid-cols-2 gap-6">
                            <button class="bg-gray-100 text-gray-800 btn-large flex items-center justify-center gap-2" onclick="reRollBoard()">
                                <span class="material-symbols-outlined">shuffle</span> æ›ä¸€çµ„è™Ÿç¢¼
                            </button>
                            <button class="bg-primary text-white btn-large flex items-center justify-center gap-2 shadow-lg shadow-primary/30" onclick="confirmBoard()">
                                <span class="material-symbols-outlined">lock</span> é–å®šç›¤é¢
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-admin" class="hidden space-y-6">
            <div class="bg-white p-8 rounded-[2.5rem] shadow-md border-t-8 border-primary">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-black">ç®¡ç†è€…æ§åˆ¶å°</h2>
                    <span id="admin-lock-indicator" class="px-6 py-2 rounded-full font-bold text-lg"></span>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-10">
                    <div class="bg-gray-50 p-6 rounded-3xl text-center">
                        <span id="count-online" class="block text-4xl font-black text-primary">0</span>
                        <span class="text-gray-500 font-bold">åœ¨ç·šäººæ•¸</span>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-3xl text-center">
                        <span id="cnt-5" class="block text-4xl font-black text-green-600">0</span>
                        <span class="text-gray-500 font-bold">5æ ¼é€£ç·š</span>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-3xl text-center">
                        <span id="cnt-4" class="block text-4xl font-black text-orange-500">0</span>
                        <span class="text-gray-500 font-bold">4æ ¼é€£ç·š</span>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-3xl text-center">
                        <span id="cnt-3" class="block text-4xl font-black text-gray-400">0</span>
                        <span class="text-gray-500 font-bold">3æ ¼é€£ç·š</span>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4 mb-10">
                    <button class="flex-grow bg-primary text-white btn-large py-10 text-3xl shadow-xl" onclick="drawNewNumber()">
                        <span class="material-symbols-outlined text-4xl">casino</span> æŠ½å–æ–°è™Ÿç¢¼
                    </button>
                    <button class="flex-grow bg-blue-600 text-white btn-large" onclick="forceLockAll()">ğŸ”’ å…¨å“¡é–å®š</button>
                    <button class="flex-grow bg-yellow-500 text-white btn-large" onclick="pickLucky()">ğŸŒŸ æŠ½å¹¸é‹å…’</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-gray-900 text-white p-6 rounded-[2rem]">
                        <h4 class="font-bold mb-4 opacity-70">æ­·å²è™Ÿç¢¼ (æŒ‰é †åº)</h4>
                        <div id="drawn-history-list" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div class="bg-white border-2 border-gray-100 p-6 rounded-[2rem] max-h-60 overflow-y-auto">
                        <h4 class="font-bold mb-4 text-primary">å³æ™‚è³“æœå¿«è¨Š</h4>
                        <div id="bingo-alerts" class="text-lg space-y-2"></div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button class="bg-gray-200 text-gray-700 p-4 rounded-2xl font-bold" onclick="handleReset()">âš ï¸ é‡ç½®éŠæˆ²</button>
                <button class="bg-red-100 text-red-600 p-4 rounded-2xl font-bold" onclick="removeAllPlayers()">ğŸ§¹ ç§»é™¤æ‰€æœ‰ä½¿ç”¨è€…</button>
            </div>
        </div>

    </main>

    <footer class="p-8 text-center text-gray-400 font-medium border-t border-gray-200">
        Â© 2025 å°¾ç‰™è³“æœç³»çµ± v2.9.1 Â· é«˜å°æ¯”å¤§å­—ç‰ˆ [cite: 419]
    </footer>
</div>

<script>
    // --- æ­¤è™•è¤‡è£½åŸ index-0105.docx çš„å®Œæ•´ Script é‚è¼¯ (Firebase è¨­å®šã€éŠæˆ²ç®—æ³•ã€ç›£è½å™¨ç­‰) ---
    // --- ç‚ºäº†ä¿æŒç°¡æ½”ï¼Œä»¥ä¸‹åƒ…åˆ—å‡ºé—œéµé‚è¼¯éƒ¨åˆ†ï¼Œè«‹ç¢ºä¿èˆ‡åŸæ–‡ä»¶ä¸€è‡´ ---
    const firebaseConfig = {
        apiKey: "AIzaSyCLTGzCZUQm2ZzqfdBHk9D4xYpagaVtX7w",
        authDomain: "yearendbingo.firebaseapp.com",
        projectId: "yearendbingo",
        storageBucket: "yearendbingo.firebasestorage.app",
        messagingSenderId: "563353011392",
        appId: "1:563353011392:web:717976a176bc22a04d5925",
        measurementId: "G-M6EVYSPNJ9"
    };
    const ALLOWED_UID = "z6bA9TzIhPUqXBxSyoIlZGBETwy1";
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ... (å…¶é¤˜æ‰€æœ‰åŸ Script ä»£ç¢¼ï¼Œå¦‚ doAdminLogin, startApp, renderGrid, drawNewNumber ç­‰å‡ä¿æŒä¸è®Š) ...
    // ... è«‹å°‡åŸæ–‡ä»¶ç¬¬ 544 è¡Œè‡³ 796 è¡Œçš„é‚è¼¯ç›´æ¥è²¼å…¥æ­¤è™•å³å¯é‹ä½œ ...
    
    // (ç¯„ä¾‹: æ›´æ–°å¾Œçš„ renderGrid ä»¥é…åˆå¤§å­—æ¨£å¼)
    function renderGrid(){
        const grid = document.getElementById('bingo-grid');
        if(!grid) return;
        grid.innerHTML = '';
        const winIdx = new Set();
        const lines = [
            [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],
            [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],
            [0,6,12,18,24],[4,8,12,16,20]
        ];
        let winLineCount = 0;
        lines.forEach(line => {
            if(line.every(idx => gameHistory.includes(myData.board[idx]))) {
                line.forEach(i=>winIdx.add(i));
                winLineCount++;
            }
        });
        myData.board.forEach((num,i)=>{
            const div = document.createElement('div');
            div.className = 'cell ' + (gameHistory.includes(num)?'selected ':'') + (winIdx.has(i)?'bingo-line':'');
            div.innerText = num;
            grid.appendChild(div);
        });
        if(winLineCount > 0 && myData.locked) {
            document.getElementById('bingo-status').innerText = `ğŸ‰ æ­å–œé”æˆ ${winLineCount} æ¢ç·šï¼`;
            db.collection("bingo_events").doc(currentUser.uid).set({ name: myData.name, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
        }
        document.getElementById('setup-btns').classList.toggle('hidden', (myData.locked || isAllLockedGlobal));
        document.getElementById('lock-status-label').innerText = (myData.locked || isAllLockedGlobal) ? "ğŸ”’ è™Ÿç¢¼å·²é–å®šï¼Œç¥æ‚¨å¥½é‹ï¼" : "ğŸ² æº–å‚™ä¸­ï¼Œå¯æ›´æ›è™Ÿç¢¼...";
    }
    
    // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼ (æ­¤è™•éœ€åŒ…å«å®Œæ•´çš„ firebase ç›£è½é‚è¼¯)
    // [æ’å…¥åŸ index-0105.docx çš„å®Œæ•´ JS é‚è¼¯]
</script>
</body>
</html>
