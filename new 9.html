<!doctype html>
<html lang="zh-Hant" class="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <title>2025 å°¾ç‰™è³“æœç³»çµ± v2.9.1</title>

    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        /* CSS æ¨£å¼ï¼šä»¥ new 9 ç‚ºä¸»ä¸¦é‡å°é•·è€…æ”¾å¤§ */
        :root {
            --primary: #f45925; /* new 9 ä¸»æ©˜è‰² */
            --primary-dark: #d64010;
            --background: #f8f6f5;
            --surface: #ffffff;
            --text-main: #1c110d;
            --radius-lg: 1.5rem;
            --shadow: 0 10px 30px rgba(244, 89, 37, 0.2);
            --font-main: 'Spline Sans', 'Noto Sans TC', sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            font-family: var(--font-main);
            background-color: var(--background);
            color: var(--text-main);
            line-height: 1.4;
        }

        /* å–æ¶ˆå¯¬åº¦é™åˆ¶ */
        .container {
            width: 95%;
            margin: 0 auto;
            padding: 20px 0;
        }

        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 25px 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(244, 89, 37, 0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .title {
            font-size: 2.2rem; /* æ¨™é¡Œæ”¾å¤§ */
            font-weight: 800;
            color: var(--primary);
            letter-spacing: -1px;
        }

        /* è™Ÿç¢¼é¡¯ç¤ºå€ï¼šæ¥µå¤§åŒ– */
        #draw-display {
            font-size: 8rem; /* é•·è€…æœ€éœ€è¦çš„å·¨å¤§å­—é«” */
            font-weight: 900;
            color: var(--primary);
            text-align: center;
            line-height: 1;
            margin: 20px 0;
            text-shadow: 0 4px 15px rgba(244, 89, 37, 0.2);
        }

        /* 5x5 è³“æœç›¤é¢ï¼šä½”æ»¿å¯¬åº¦ */
        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            width: 100%;
            margin: 20px auto;
        }

        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fdf2ef;
            border-radius: 50%; /* åœ“çƒé€ å‹ */
            font-weight: 800;
            font-size: 2.2rem; /* è™Ÿç¢¼æ”¾å¤§ */
            color: var(--text-main);
            border: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .cell.selected {
            background-color: var(--primary);
            color: white;
            transform: scale(1.08);
            box-shadow: 0 8px 20px rgba(244, 89, 37, 0.4);
        }

        .cell.bingo-line {
            background-color: #2e7d32; /* è³“æœæ”¹ç‚ºæ·±ç¶ è‰²ï¼Œé«˜å°æ¯” */
            color: #fff;
            animation: bingo-pulse 1s infinite;
            border: 4px solid #ffb300;
        }

        @keyframes bingo-pulse {
            0% { transform: scale(1.05); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1.05); }
        }

        /* æŒ‰éˆ•å„ªåŒ– */
        .btn {
            padding: 22px 30px;
            border-radius: 50px;
            border: none;
            font-weight: 700;
            font-size: 1.5rem; /* å­—é«”æ”¾å¤§ */
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .btn.primary {
            background: var(--primary);
            color: #fff;
            box-shadow: 0 10px 20px rgba(244, 89, 37, 0.3);
        }

        .btn.primary:active { transform: scale(0.96); }

        .btn.ghost {
            background: transparent;
            color: var(--text-main);
            border: 3px solid #f4eae7;
        }

        /* è¼¸å…¥æ¡†æ”¾å¤§ */
        input[type="text"], input[type="email"], input[type="password"] {
            width: 100%;
            padding: 20px;
            font-size: 1.5rem;
            border-radius: 15px;
            border: 3px solid #f4eae7;
            margin-bottom: 15px;
            outline: none;
        }

        input:focus { border-color: var(--primary); }

        .hidden { display: none; }
        
        /* æ­·å²è™Ÿç¢¼çƒ */
        .history-ball {
            display: inline-block;
            width: 50px;
            height: 50px;
            line-height: 50px;
            background: #eee;
            border-radius: 50%;
            margin: 5px;
            text-align: center;
            font-weight: 800;
            font-size: 1.3rem;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="title" onclick="triggerAdmin()">ğŸ® 2025 è³“æœ</div>
        <div id="user-info" style="font-size:1.3rem; font-weight:700;">è¼‰å…¥ä¸­...</div>
    </div>

    <div id="view-login" class="card hidden">
        <h2 style="text-align:center; font-size:2rem; margin-bottom:30px;">è«‹è¼¸å…¥å§“ååƒåŠ </h2>
        <input id="player-name" type="text" placeholder="æ‚¨çš„åå­—" />
        <button class="btn primary" onclick="doPlayerLogin()">
            <span class="material-symbols-outlined">how_to_reg</span> åŠ å…¥éŠæˆ²
        </button>
    </div>

    <div id="view-player" class="hidden">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <div id="player-name-display" style="font-size:1.6rem; font-weight:800; color:var(--primary);"></div>
                <button class="btn ghost" style="width:auto; padding:10px 20px; font-size:1rem;" onclick="doSignOut()">ç™»å‡º</button>
            </div>
            
            <div style="text-align:center;">
                <div style="font-size:1.2rem; font-weight:700; color:#666;">æœ€æ–°é–‹å‡ºè™Ÿç¢¼</div>
                <div id="draw-display">READY</div>
                <div id="bingo-status" style="height:45px; color:#2e7d32; font-weight:900; font-size:1.8rem;"></div>
                
                <div id="bingo-grid" class="grid"></div>
                
                <div id="setup-btns" style="margin-top:25px; display:flex; flex-direction:column; gap:15px;">
                    <button class="btn ghost" onclick="reRollBoard()">
                        <span class="material-symbols-outlined">cached</span> æ›ä¸€çµ„è™Ÿç¢¼
                    </button>
                    <button class="btn primary" onclick="confirmBoard()">
                        <span class="material-symbols-outlined">check_circle</span> é–å®šç›¤é¢é–‹å§‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-admin" class="hidden">
        <div class="card">
            <h2 style="font-size:2rem; color:var(--primary);">ç¸½æ§åˆ¶å°</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                <div style="background:#1c110d; color:white; padding:20px; border-radius:15px; text-align:center;">
                    <span style="display:block; font-size:1rem;">å·²åŠ å…¥äººæ•¸</span>
                    <span id="stat-join" style="font-size:2.5rem; font-weight:800; color:var(--primary);">0</span>
                </div>
                <div style="background:#1c110d; color:white; padding:20px; border-radius:15px; text-align:center;">
                    <span style="display:block; font-size:1rem;">å·²é–å®šç›¤é¢</span>
                    <span id="stat-lock" style="font-size:2.5rem; font-weight:800; color:#4caf50;">0</span>
                </div>
            </div>
            <button class="btn primary" id="roll-btn" onclick="drawNext()" style="height:120px; font-size:2.5rem;">
                <span class="material-symbols-outlined" style="font-size:3rem;">casino</span> æŠ½å–è™Ÿç¢¼
            </button>
            <div style="margin-top:20px;">
                <h3>æ­·å²è™Ÿç¢¼</h3>
                <div id="history-list"></div>
            </div>
            <button class="btn ghost" style="margin-top:30px; border-color:#ff5252; color:#ff5252;" onclick="resetGame()">é‡ç½®éŠæˆ²</button>
        </div>
    </div>
</div>

<div id="admin-modal" style="position:fixed; inset:0; background:rgba(0,0,0,0.85); display:none; align-items:center; justify-content:center; z-index:1000; padding:20px;">
    <div class="card" style="width:100%; max-width:400px;">
        <h3 style="font-size:1.8rem; margin-bottom:20px;">ç®¡ç†è€…é©—è­‰</h3>
        <input id="admin-email" type="email" placeholder="ç®¡ç†å¸³è™Ÿ" />
        <input id="admin-pwd" type="password" placeholder="å¯†ç¢¼" />
        <button class="btn primary" onclick="doAdminLogin()">ç™»å…¥</button>
        <button class="btn ghost" style="margin-top:10px;" onclick="closeAdminModal()">å–æ¶ˆ</button>
    </div>
</div>

<script>
    // --- Firebase è¨­å®š (è«‹ç¢ºä¿èˆ‡æ‚¨çš„å°ˆæ¡ˆä¸€è‡´) ---
	const firebaseConfig = {
	  apiKey: "AIzaSyCLTGzCZUQm2ZzqfdBHk9D4xYpagaVtX7w",
	  authDomain: "yearendbingo.firebaseapp.com",
	  projectId: "yearendbingo",
	  storageBucket: "yearendbingo.firebasestorage.app",
	  messagingSenderId: "563353011392",
	  appId: "1:563353011392:web:717976a176bc22a04d5925",
	  measurementId: "G-M6EVYSPNJ9"
	};
	const ALLOWED_UID = "z6bA9TzIhPUqXBxSyoIlZGBETwy1";
	firebase.initializeApp(firebaseConfig);
	const db = firebase.firestore();
	const auth = firebase.auth();

	let currentUser = null;
	let myData = { name:"", board:[], locked:false };
	let gameHistory = [];
	let allPlayersCache = [];
	let rollingTimer = null;
	let isAllLockedGlobal = false; 

	function logStatus(msg) {
	  const el = document.getElementById('status-log');
	  if(!el) return;
	  el.innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>` + el.innerHTML;
	}

	function triggerAdmin() {
	  window.ac = (window.ac || 0) + 1;
	  if(window.ac >= 5) { document.getElementById('admin-modal').style.display = 'flex'; window.ac = 0; }
	}
	function closeAdminModal() { document.getElementById('admin-modal').style.display = 'none'; }

	async function doAdminLogin(){
	  const email = document.getElementById('admin-email').value;
	  const pwd = document.getElementById('admin-pwd').value;
	  try {
		const cred = await auth.signInWithEmailAndPassword(email, pwd);
		if(cred.user.uid === ALLOWED_UID) { closeAdminModal(); logStatus("ç®¡ç†å“¡ç™»å…¥æˆåŠŸ"); }
		else { alert("æ¬Šé™ä¸è¶³"); await auth.signOut(); }
	  } catch(e){ alert("ç™»å…¥å¤±æ•—"); }
	}

	auth.onAuthStateChanged(async user => {
	  currentUser = user;
	  if(!user){ showView('login'); return; }
	  if(user.uid === ALLOWED_UID){ showView('admin'); startApp(); return; }
	  
	  const snap = await db.collection("players").doc(user.uid).get();
	  if(snap.exists){ 
		myData = snap.data(); 
	  } else {
		const name = document.getElementById('player-name').value || "è¨ªå®¢";
		myData = { name, board: shuffleArray(), locked:false, lastSeen: firebase.firestore.FieldValue.serverTimestamp() };
		await db.collection("players").doc(user.uid).set(myData);
	  }
	  document.getElementById('user-info').innerText = myData.name;
	  document.getElementById('player-name-display').innerText = myData.name;
	  showView('player');
	  startApp();
	});

	async function doPlayerLogin(){
	  if(!document.getElementById('player-name').value.trim()) return alert("è«‹è¼¸å…¥å§“å");
	  await auth.signInAnonymously();
	}

	function showView(name){
	  document.getElementById('view-login').classList.add('hidden');
	  document.getElementById('view-player').classList.add('hidden');
	  document.getElementById('view-admin').classList.add('hidden');
	  document.getElementById('view-'+name).classList.remove('hidden');
	}

	function startApp(){
	  db.collection("game_state").doc("current_game").onSnapshot(doc => {
		const data = doc.data() || { history:[], isRolling:false, isAllLocked:false, luckyUser:"" };
		gameHistory = data.history || [];
		isAllLockedGlobal = data.isAllLocked || false;
		
		if(document.getElementById('admin-lock-indicator')) {
			document.getElementById('admin-lock-indicator').innerText = isAllLockedGlobal ? "âœ… å·²é–å®š" : "ğŸ”“ æœªé–å®š";
			document.getElementById('admin-lock-indicator').style.background = isAllLockedGlobal ? "#c8e6c9" : "#eee";
		}

		const last = gameHistory.length ? gameHistory[gameHistory.length-1] : "READY";
		document.getElementById('drawn-history-list').innerHTML = gameHistory.map(n => `<span class="history-ball">${n}</span>`).join('') || "ç­‰å¾…é–‹è™Ÿ";

		if(data.isRolling){
		  if(!rollingTimer) rollingTimer = setInterval(()=> {
			const r = Math.floor(Math.random()*25)+1;
			document.getElementById('draw-display').innerText = r;
			if(document.getElementById('admin-sync-num')) document.getElementById('admin-sync-num').innerText = r;
		  }, 80);
		} else {
		  clearInterval(rollingTimer); rollingTimer=null;
		  document.getElementById('draw-display').innerText = last;
		  if(document.getElementById('admin-sync-num')) document.getElementById('admin-sync-num').innerText = last;
		  renderGrid();
		  if(currentUser.uid === ALLOWED_UID) updateConnectedStats();
		}

		// --- å¹¸é‹å…’åŠŸèƒ½ä¿®æ­£ï¼šå¢åŠ é©—è­‰é‚è¼¯ ---
		if(data.luckyUser && data.luckyUser === myData.name && !data.isRolling && currentUser.uid !== ALLOWED_UID) {
		   let valid = false;
		   let num;
		   while(!valid) {
			 const input = prompt(`ã€ğŸŒŸ æ­å–œä½ æ˜¯å¹¸é‹å…’ï¼ã€‘\nè«‹è¼¸å…¥ä¸€å€‹è™Ÿç¢¼ (1-25)ï¼š\n(æ³¨æ„ï¼šä¸èƒ½é‡è¤‡æŠ½éçš„è™Ÿç¢¼)`);
			 if(input === null) break; // ç©å®¶æŒ‰å–æ¶ˆ
			 num = parseInt(input);
			 if(isNaN(num) || num < 1 || num > 25) {
				alert("éŒ¯èª¤ï¼šè«‹è¼¸å…¥ 1 åˆ° 25 ä¹‹é–“çš„æ•¸å­—ã€‚");
			 } else if(gameHistory.includes(num)) {
				alert(`éŒ¯èª¤ï¼š${num} å·²ç¶“è¢«æŠ½éå›‰ï¼Œè«‹æ›ä¸€å€‹ã€‚`);
			 } else {
				valid = true;
			 }
		   }
		   if(valid) {
			 db.collection("pending_choices").doc(currentUser.uid).set({
			   playerName: myData.name, number: num, timestamp: firebase.firestore.FieldValue.serverTimestamp()
			 });
			 db.collection("game_state").doc("current_game").update({ luckyUser: "" });
		   }
		}
	  });

	  db.collection("players").onSnapshot(snap => {
		allPlayersCache = snap.docs.map(d => ({id: d.id, ...d.data()}));
		document.getElementById('count-total').innerText = allPlayersCache.length;
		if(currentUser.uid !== ALLOWED_UID){
		  const me = allPlayersCache.find(p => p.id === currentUser.uid);
		  if(me && me.locked !== myData.locked) {
			myData.locked = me.locked;
			renderGrid();
		  }
		}
	  });

	  if(currentUser.uid === ALLOWED_UID){
		db.collection("pending_choices").orderBy("timestamp","desc").onSnapshot(snap => {
		  document.getElementById('pending-choices').innerHTML = snap.docs.map(d => `<div>â“ ${d.data().playerName} é¸äº† ${d.data().number} <button onclick="confirmLucky('${d.id}', ${d.data().number})">æ¡ç´</button></div>`).join('');
		});
		db.collection("bingo_events").orderBy("timestamp","desc").limit(10).onSnapshot(snap => {
		  document.getElementById('bingo-alerts').innerHTML = snap.docs.map(d => `<div>ğŸ‰ <b>${d.data().name}</b> è³“æœäº†ï¼</div>`).join('');
		});
	  }
	}

	function renderGrid(){
	  const grid = document.getElementById('bingo-grid');
	  if(!grid) return;
	  grid.innerHTML = '';
	  const winIdx = new Set();
	  const lines = [
		[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24], // æ©«
		[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24], // ç›´
		[0,6,12,18,24],[4,8,12,16,20] // æ–œ
	  ];
	  let winLineCount = 0;
	  lines.forEach(line => {
		if(line.every(idx => gameHistory.includes(myData.board[idx]))) {
			line.forEach(i=>winIdx.add(i));
			winLineCount++;
		}
	  });
	  myData.board.forEach((num,i)=>{
		const div = document.createElement('div');
		div.className = 'cell ' + (gameHistory.includes(num)?'selected ':'') + (winIdx.has(i)?'bingo-line':'');
		div.innerText = num;
		grid.appendChild(div);
	  });
	  if(winLineCount > 0 && myData.locked) {
		document.getElementById('bingo-status').innerText = `å·²é”æˆ ${winLineCount} æ¢ç·šï¼`;
		db.collection("bingo_events").doc(currentUser.uid).set({ name: myData.name, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
	  }
	  document.getElementById('setup-btns').style.display = (myData.locked || isAllLockedGlobal) ? 'none' : 'flex';
	  document.getElementById('lock-status-label').innerText = (myData.locked || isAllLockedGlobal) ? "ğŸ”’ ç›¤é¢å·²é–å®š" : "ğŸ² è¨­å®šä¸­...";
	}

	// --- ç®—æ³•ä¿®å¾©ï¼šè¨ˆç®— 12 æ¢ç·šä¸­æœ€é•·çš„ã€Œé€£çºŒå‘½ä¸­ã€æ ¼æ•¸ ---
	function calculateMaxConsecutive(board, history) {
	  const lines = [
		[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24], // æ©«
		[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24], // ç›´
		[0,6,12,18,24],[4,8,12,16,20] // æ–œ
	  ];
	  let globalMax = 0;

	  lines.forEach(line => {
		let currentMax = 0;
		let streak = 0;
		line.forEach(index => {
		  if(history.includes(board[index])) {
			streak++;
			if(streak > currentMax) currentMax = streak;
		  } else {
			streak = 0;
		  }
		});
		if(currentMax > globalMax) globalMax = currentMax;
	  });
	  return globalMax;
	}

	function updateConnectedStats(){
	  const counts = {5:0,4:0,3:0,2:0};
	  allPlayersCache.forEach(p=>{
		if(!p.board || !p.locked) return;
		const max = calculateMaxConsecutive(p.board, gameHistory);
		if(max >= 5) counts[5]++; 
		else if(max === 4) counts[4]++;
		else if(max === 3) counts[3]++;
		else if(max === 2) counts[2]++;
	  });
	  document.getElementById('cnt-5').innerText = counts[5];
	  document.getElementById('cnt-4').innerText = counts[4];
	  document.getElementById('cnt-3').innerText = counts[3];
	  document.getElementById('cnt-2').innerText = counts[2];
	}

	/* å…¶ä»–ç®¡ç†åŠŸèƒ½èˆ‡é‡ç½®é‚è¼¯ (ä¿æŒ v2.9 å„ªåŒ–) */
	async function forceLockAll() {
	  logStatus("æ­£åœ¨åŸ·è¡Œå…¨å“¡é–å®š...");
	  const batch = db.batch();
	  allPlayersCache.forEach(p => batch.update(db.collection("players").doc(p.id), { locked: true }));
	  await batch.commit();
	  await db.collection("game_state").doc("current_game").update({ isAllLocked: true });
	}

	async function drawNewNumber(){
	  const ref = db.collection("game_state").doc("current_game");
	  if(!isAllLockedGlobal) await forceLockAll();
	  const snap = await ref.get();
	  const hist = snap.data().history || [];
	  const pool = Array.from({length:25},(_,i)=>i+1).filter(n=>!hist.includes(n));
	  if(!pool.length) return alert("æŠ½å®Œå›‰");
	  await ref.update({ isRolling:true });
	  setTimeout(async ()=>{
		const p = pool[Math.floor(Math.random()*pool.length)];
		await ref.update({ history: firebase.firestore.FieldValue.arrayUnion(p), isRolling:false, luckyUser: "" });
	  }, 1200);
	}

	async function removeAllPlayers() {
	  if(!confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰ä½¿ç”¨è€…å—ï¼Ÿ")) return;
	  const batch = db.batch();
	  allPlayersCache.forEach(p => batch.delete(db.collection("players").doc(p.id)));
	  await batch.commit();
	  location.reload();
	}

	async function handleReset(){
	  if(!confirm("ç¢ºå®šé‡ç½®éŠæˆ²ï¼Ÿé€™æœƒæ¢å¾©æ‰€æœ‰äººçš„æ›è™ŸåŠŸèƒ½ã€‚")) return;
	  const batch = db.batch();
	  allPlayersCache.forEach(p => batch.update(db.collection("players").doc(p.id), { locked: false }));
	  const colls = ["pending_choices","bingo_events"];
	  for(const c of colls){
		const s = await db.collection(c).get();
		s.forEach(d=>batch.delete(d.ref));
	  }
	  batch.set(db.collection("game_state").doc("current_game"), { history:[], isRolling:false, isAllLocked:false, luckyUser:"" });
	  await batch.commit();
	  location.reload();
	}

	async function confirmLucky(id, num) {
	  await db.collection("game_state").doc("current_game").update({ history: firebase.firestore.FieldValue.arrayUnion(num), luckyUser: "" });
	  await db.collection("pending_choices").doc(id).delete();
	}

	async function pickLucky() {
	  if(allPlayersCache.length === 0) return alert("æ²’äººåƒèˆ‡");
	  const lucky = allPlayersCache[Math.floor(Math.random()*allPlayersCache.length)].name;
	  await db.collection("game_state").doc("current_game").update({ luckyUser: lucky });
	  alert("å¹¸é‹å…’æ˜¯ï¼š" + lucky);
	}

	function shuffleArray(){ return Array.from({length:25},(_,i)=>i+1).sort(()=>Math.random()-0.5); }
	function reRollBoard(){ myData.board = shuffleArray(); renderGrid(); }
	async function confirmBoard(){
	  if(!confirm("ç¢ºå®šé–å®šï¼Ÿ")) return;
	  await db.collection("players").doc(currentUser.uid).update({ locked:true });
	  myData.locked = true; renderGrid();
	}
	function doSignOut(){ auth.signOut(); location.reload(); }
	setInterval(() => {
	  if(currentUser && currentUser.uid !== ALLOWED_UID) {
		db.collection("players").doc(currentUser.uid).update({ lastSeen: firebase.firestore.FieldValue.serverTimestamp() }).catch(()=>{});
	  }
	}, 15000);

</script>

</body>
</html>